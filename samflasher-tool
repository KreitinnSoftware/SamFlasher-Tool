case $1 in detect)
    killall yad
esac

if [ -e /tmp/samflasher-tool/ ]; then
    rm -rf /tmp/samflasher-tool/
fi

if [ ! -e /usr/bin/samflasher-tool ]; then
    echo Please install samflasher-tool by script install.sh
    exit
fi

if [ ! -e /usr/bin/heimdall ]; then
    echo You need to install Heimdall to use SamFlasher-Tool.
    exit
elif [ ! -e /usr/bin/yad ]; then
    echo You need to install YAD to use SamFlasher-Tool.
fi

asp="'t"

HD=$(heimdall detect)
case $HD in '')
    HD='ERROR: Device is missing'
;;
    'Device detected')
    HD='Device connected'
esac

menu=$(yad --form --columns=1 \
   --window-icon=$HOME/.local/share/icons/samflashertool.png  \
   --width=900 \
   --height=200 \
   --center \
   --text="$HD" \
   --title='SamFlasher Tool v1.3' \
   --field="Don$asp reboot after the installation":CHK \
   --field='Reload device/Clear files':BTN "" "samflasher-tool detect" \
   --button=Flash \
   --field=CP:FL \
   --field=AP:FL \
   --field=BL:FL \
   --field=CSC:FL)

case $menu in '')
    exit
esac

case $HD in 'ERROR: Device is missing')
    ERR1=$(yad --title='SamFlasher Tool v1.3' --window-icon=$HOME/.local/share/icons/samflashertool.png --warning --text='ERROR: No devices available for installation.' --button='Back to menu')
esac
case $HD in 'ERROR: Device is missing')
    case $ERR1 in '')
        samflasher-tool
        exit
    esac
esac

mkdir /tmp/samflasher-tool
cd /tmp/samflasher-tool
case $menu in *TRUE*)
    noreboot='--no-reboot'
esac
echo $menu > fl2p
sed -i "s/ /#/g" fl2p
sed -i "s/FALSE//g" fl2p
sed -i "s/TRUE//g" fl2p
sed -i "s/|/ /g" fl2p
flsp=$(cat fl2p)
echo 'echo "$1" > 1' > flp.sh
echo 'echo "$2" > 2' >> flp.sh
echo 'echo "$3" > 3' >> flp.sh
echo 'echo "$4" > 4' >> flp.sh
sh flp.sh $flsp
sed -i 's/#/ /g' 1
sed -i 's/#/ /g' 2
sed -i 's/#/ /g' 3
sed -i 's/#/ /g' 4
a=$(cat 1)
b=$(cat 2)
c=$(cat 3)
d=$(cat 4)
rm flp.sh 1 2 3 4
ap=$(file "$a")
bp=$(file "$b")
cp=$(file "$c")
dp=$(file "$d")

case $a in '')
    g=$((g+1))
esac
case $b in '')
    g=$((g+1))
esac
case $c in '')
    g=$((g+1))
esac
case $d in '')
    g=$((g+1))
esac
case $g in 4)
    timeout 3 yad --title='SamFlasher Tool v1.3' --window-icon=$HOME/.local/share/icons/samflashertool.png --warning --text='Please choose the files needed for installation' --no-buttons --width=350 --height=100 --center
    samflasher-tool
    exit
esac

yad --title='SamFlasher Tool v1.3' --window-icon=$HOME/.local/share/icons/samflashertool.png --warning --text='Wait a while while we extract the files' --no-buttons --width=250 --height=100 --center &

case $a in *.tar*)
    tar -xf "$a" > /dev/zero
esac
case $b in *.tar*)
    tar -xf "$b" > /dev/zero
esac
case $c in *.tar*)
    tar -xf "$c" > /dev/zero
esac
case $d in *.tar*)
    tar -xf "$d" > /dev/zero
esac
lz4ck=$(ls)
case $lz4ck in *.lz4)
    lz4 -dm *.lz4 > /dev/zero
esac

pids=$(jobs -pr)
case $pids in *)
    kill $pids
esac

yad --title='SamFlasher Tool v1.3' --window-icon=$HOME/.local/share/icons/samflashertool.png --warning --text='Wait a while while we flash the firmware' --no-buttons --width=250 --height=100 --center & 

files=$(ls)
case $files in *boot.img*)
    parametros="$parametros --BOOT boot.img"
esac
case $files in *sboot.bin*)
    parametros="$parametros --BOOTLOADER sboot.bin"
esac
case $files in *cm.bin*)
    parametros="$parametros --CM cm.bin"
esac
case $files in *userdata.img*) 
    parametros="$parametros --USERDATA userdata.img"
esac
case $files in *md5.img*)
    parametros="$parametros --MD5HDR md5.img"
esac
case $files in *ect.bin*)
    parametros="$parametros --ECT ect.bin"
esac
case $files in *modem_debug.bin*)
    parametros="$parametros --CP_DEBUG modem_debug.bin"
esac
case $files in *hidden.img*)
    parametros="$parametros --HIDDEN hidden.img"
esac
case $files in *cache.img*)
    parametros="$parametros --CACHE cache.img"
esac
case $files in *efs.img*)
    parametros="$parametros --EFS efs.img"
esac
case $files in *cpefs.img*)
    parametros="$parametros --CPEFS cpefs.img"
esac
case $files in *m9kefs1.bin*)
    parametros="$parametros --m9kefs1 m9kefs1.bin"
esac
case $files in *m9kefs2.bin*)
    parametros="$parametros --m9kefs2 m9kefs2.bin"
esac
case $files in *m9kefs3.bin*)
    parametros="$parametros --m9kefs3 m9kefs3.bin"
esac
case $files in *carrier.img*)
    parametros="$parametros --CARRIER carrier.img"
esac
case $files in *param.bin*)
    parametros="$parametros --PARAM param.bin"
esac
case $files in *recovery.img*)
    parametros="$parametros --RECOVERY recovery.img"
esac
case $files in *modem_cdma.bin*)
    parametros="$parametros --CDMA-RADIO modem_cdma.bin"
esac
case $files in *modem.bin*)
    parametros="$parametros --RADIO modem.bin"
esac
case $files in *tombstones.img*)
    parametros="$parametros --TOMBSTONES tombstones.img"
esac
case $files in *dnt.ssw*)
    parametros="$parametros --DNT dnt.ssw"
esac
case $files in *steady.bin*)
    parametros="$parametros --STEADY steady.bin"
esac
case $files in *system.img*)
    parametros="$parametros --SYSTEM system.img"
esac

if [ ! -e *.pit ]; then
    heimdall flash $parametros $noreboot
    samflasher-tool
    pids=$(jobs -pr)
    case $pids in *)
        kill $pids
    esac
    exit
fi
heimdall flash --pit *.pit $parametros $noreboot
pids=$(jobs -pr)
case $pids in *)
    kill $pids
esac
samflasher-tool
